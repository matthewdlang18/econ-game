<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Odyssey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/header-styles.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="../styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Chart.js and Chart.js Zoom plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- Chart.js Zoom plugin is optional, only include if needed -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script> -->
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header>
        <div class="banner-container">
            <!-- Use a background color instead of an image -->
            <div style="background: linear-gradient(135deg, #1e5799 0%,#2989d8 50%,#207cca 51%,#7db9e8 100%); width: 100%; height: 100%;" class="banner-image"></div>
            <div class="banner-overlay">
                <div class="container mx-auto">
                    <div class="nav-links">
                        <div class="nav-links-left">
                            <a href="../index.html" class="nav-link">Home</a>
                            <a href="index.html" class="nav-link active">Play Game</a>
                            <a href="leaderboard.html" class="nav-link">Leaderboard</a>
                        </div>
                        <div class="nav-links-right">
                            <!-- User info (shown when logged in) -->
                            <div class="user-info" id="user-info-container">
                                <div class="user-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span class="user-name" id="user-name-display">Guest</span>
                                <button class="sign-out-btn" id="sign-out-btn">Sign Out</button>
                            </div>

                            <!-- Sign in link (shown when not logged in) -->
                            <a href="../index.html" class="nav-link" id="sign-in-link">Sign In</a>

                            <!-- Guest link (shown when not logged in) -->
                            <a href="#" class="nav-link" id="guest-link">Continue as Guest</a>
                        </div>
                    </div>
                    <h1 class="activity-title">Investment Odyssey</h1>
                    <p class="activity-date">Practice your investment skills in this simulation</p>
                </div>
            </div>
        </div>
    </header>

    <div class="container">

        <!-- Asset Price Ticker -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="ticker-container">
                    <div class="ticker-wrap">
                        <div class="ticker" id="price-ticker">
                            <!-- Asset prices will be populated here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Progress -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card bg-light">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-0">Game Progress: Round <span id="current-round-display">0</span> of 20</h5>
                            </div>
                            <div>
                                <button id="start-game" class="btn btn-success">Start Game</button>
                                <button id="restart-game" class="btn btn-danger ml-2">Start Over <i class="fas fa-redo"></i></button>
                            </div>
                        </div>
                        <div class="progress mt-2">
                            <div id="round-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Portfolio Summary -->
        <div class="row mb-3">
            <div class="col-md-4 mb-3 mb-md-0">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">Cash</h5>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center">
                        <h3 class="text-success mb-0">$<span id="cash-display">10000.00</span></h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3 mb-md-0">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">Portfolio Value</h5>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center">
                        <h3 class="text-primary mb-0">$<span id="portfolio-value-display">0.00</span></h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">Total Value</h5>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center">
                        <h3 class="text-info mb-0">$<span id="total-value-display">10000.00</span></h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Controls & Trading -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h3 class="mb-0" style="font-size: 1.5rem;">Game Controls & Trading</h3>
                    </div>
                    <div class="card-body" style="padding: 0.75rem;">
                        <div class="mb-2">
                            <div class="row no-gutters">
                                <div class="col-md-3">
                                    <h5 style="font-size: 0.85rem; margin-bottom: 0.5rem;">Cash: $<span id="cash-display">10000.00</span></h5>
                                </div>
                                <div class="col-md-3">
                                    <h5 style="font-size: 0.85rem; margin-bottom: 0.5rem;">Portfolio: $<span id="portfolio-value-display">0.00</span></h5>
                                </div>
                                <div class="col-md-3">
                                    <h5 style="font-size: 0.85rem; margin-bottom: 0.5rem;">Total: $<span id="total-value-display">10000.00</span></h5>
                                </div>
                                <div class="col-md-3">
                                    <h5 style="font-size: 0.85rem; margin-bottom: 0.5rem;">CPI: <span id="cpi-display">100.00</span></h5>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Market Data -->
                            <div class="col-md-8">
                                <div class="card mb-3">
                                    <div class="card-header bg-light d-flex justify-content-between align-items-center" style="padding: 0.5rem 0.75rem;">
                                        <h5 class="mb-0" style="font-size: 1rem;">Market Data</h5>
                                        <button id="next-round" class="btn btn-primary btn-sm">Next Round <i class="fas fa-arrow-right"></i></button>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover mb-0">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th>Asset</th>
                                                        <th>Price</th>
                                                        <th>Change</th>
                                                        <th>Quantity</th>
                                                        <th>Value</th>
                                                        <th>% of Portfolio</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="market-data-body">
                                                    <!-- Market data will be populated here dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Trading Form -->
                            <div class="col-md-4">
                                <div class="card mb-3">
                                    <div class="card-header bg-light" style="padding: 0.5rem 0.75rem;">
                                        <h5 class="mb-0" style="font-size: 1rem;">Trade Assets</h5>
                                    </div>
                                    <div class="card-body" style="padding: 0.75rem;">
                                        <form id="trade-form" class="trading-form">
                                            <div class="form-group mb-2">
                                                <label for="asset-select" class="mb-1">Select Asset</label>
                                                <select id="asset-select" class="form-control form-control-sm">
                                                    <option value="S&P 500">S&P 500</option>
                                                    <option value="Small Caps">Small Caps</option>
                                                    <option value="Corporate Bonds">Corporate Bonds</option>
                                                    <option value="Treasury Bonds">Treasury Bonds</option>
                                                    <option value="Gold">Gold</option>
                                                    <option value="Bitcoin">Bitcoin</option>
                                                </select>
                                            </div>

                                            <div class="price-display alert alert-info py-1 px-2 mb-2" style="font-size: 0.85rem;">
                                                <strong>Current Price:</strong> $<span id="asset-price-display">100.00</span>
                                            </div>

                                            <div class="cash-display alert alert-success py-1 px-2 mb-2" style="font-size: 0.85rem;">
                                                <strong>Available Cash:</strong> $<span id="available-cash-display">10000.00</span>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label for="action-select" class="mb-1">Action</label>
                                                <div class="btn-group btn-group-toggle w-100" data-toggle="buttons">
                                                    <label class="btn btn-outline-success active" style="width: 50%">
                                                        <input type="radio" name="action" id="action-buy" value="buy" checked> Buy
                                                    </label>
                                                    <label class="btn btn-outline-danger" style="width: 50%">
                                                        <input type="radio" name="action" id="action-sell" value="sell"> Sell
                                                    </label>
                                                </div>
                                                <select id="action-select" class="d-none">
                                                    <option value="buy" selected>Buy</option>
                                                    <option value="sell">Sell</option>
                                                </select>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label for="amount-input" class="mb-1">Amount ($)</label>
                                                <input type="number" id="amount-input" class="form-control form-control-sm" placeholder="Enter amount" step="0.01" min="0">
                                                <div class="btn-group d-flex mt-1">
                                                    <button type="button" class="btn btn-sm btn-outline-primary amount-percent-btn" data-percent="25">25%</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary amount-percent-btn" data-percent="50">50%</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary amount-percent-btn" data-percent="75">75%</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary amount-percent-btn" data-percent="100">100%</button>
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label for="quantity-input" class="mb-1">Quantity</label>
                                                <div class="input-group input-group-sm">
                                                    <input type="number" id="quantity-input" class="form-control" placeholder="Enter quantity" step="0.0001" min="0">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text" id="quantity-unit">units</span>
                                                    </div>
                                                </div>
                                                <div class="btn-group d-flex mt-1">
                                                    <button type="button" class="btn btn-sm btn-outline-primary quantity-percent-btn" data-percent="25">25%</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary quantity-percent-btn" data-percent="50">50%</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary quantity-percent-btn" data-percent="75">75%</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary quantity-percent-btn" data-percent="100">100%</button>
                                                </div>
                                            </div>

                                            <div class="form-group mb-0">
                                                <button type="submit" id="buy-btn" class="btn btn-success btn-sm btn-block">Buy</button>
                                                <button type="submit" id="sell-btn" class="btn btn-danger btn-sm btn-block" style="display: none;">Sell</button>
                                            </div>

                                            <!-- Quick Trade Buttons -->
                                            <div class="mt-2">
                                                <div class="d-flex justify-content-between">
                                                    <button type="button" id="diversify-btn" class="btn btn-info btn-sm">Diversify</button>
                                                    <button type="button" id="sell-all-btn" class="btn btn-warning btn-sm">Sell All</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">

            <!-- Charts Column -->
            <div class="col-lg-12">
                <!-- Portfolio Summary -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">Your Portfolio</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Portfolio Table -->
                            <div class="col-md-7">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Asset</th>
                                                <th>Price</th>
                                                <th>Change</th>
                                                <th>Quantity</th>
                                                <th>Value</th>
                                                <th>% of Total</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="portfolio-body">
                                            <!-- Portfolio data will be populated here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Portfolio Allocation Chart -->
                            <div class="col-md-5">
                                <div class="chart-container" style="position: relative; height: 250px;">
                                    <canvas id="portfolio-allocation-chart"></canvas>
                                </div>
                                <div class="text-center mt-2">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="toggle-doughnut">Toggle Chart Type</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Portfolio Performance</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="portfolio-chart"></canvas>
                        </div>
                        <div class="text-center mt-3">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-portfolio">Zoom In</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-portfolio">Zoom Out</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-portfolio">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Asset Price Charts -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">Asset Price Charts</h5>
                    </div>
                    <div class="card-body">
                        <!-- Asset Chart Tabs -->
                        <ul class="nav nav-tabs" id="assetChartTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="sp500-tab" data-toggle="tab" href="#sp500-content" role="tab">S&P 500</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="small-caps-tab" data-toggle="tab" href="#small-caps-content" role="tab">Small Caps</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="corporate-bonds-tab" data-toggle="tab" href="#corporate-bonds-content" role="tab">Corporate Bonds</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="treasury-bonds-tab" data-toggle="tab" href="#treasury-bonds-content" role="tab">Treasury Bonds</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="gold-tab" data-toggle="tab" href="#gold-content" role="tab">Gold</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="bitcoin-tab" data-toggle="tab" href="#bitcoin-content" role="tab">Bitcoin</a>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content mt-3" id="assetChartTabContent">
                            <!-- S&P 500 Tab -->
                            <div class="tab-pane fade show active" id="sp500-content" role="tabpanel">
                                <div class="chart-container" style="position: relative; height: 300px;">
                                    <canvas id="S-P-500-chart"></canvas>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-sp500">Zoom In</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-sp500">Zoom Out</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-sp500">Reset</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Small Caps Tab -->
                            <div class="tab-pane fade" id="small-caps-content" role="tabpanel">
                                <div class="chart-container" style="position: relative; height: 300px;">
                                    <canvas id="Small-Caps-chart"></canvas>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-small-caps">Zoom In</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-small-caps">Zoom Out</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-small-caps">Reset</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Corporate Bonds Tab -->
                            <div class="tab-pane fade" id="corporate-bonds-content" role="tabpanel">
                                <div class="chart-container" style="position: relative; height: 300px;">
                                    <canvas id="Corporate-Bonds-chart"></canvas>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-corporate-bonds">Zoom In</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-corporate-bonds">Zoom Out</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-corporate-bonds">Reset</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Treasury Bonds Tab -->
                            <div class="tab-pane fade" id="treasury-bonds-content" role="tabpanel">
                                <div class="chart-container" style="position: relative; height: 300px;">
                                    <canvas id="Treasury-Bonds-chart"></canvas>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-treasury-bonds">Zoom In</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-treasury-bonds">Zoom Out</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-treasury-bonds">Reset</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Gold Tab -->
                            <div class="tab-pane fade" id="gold-content" role="tabpanel">
                                <div class="chart-container" style="position: relative; height: 300px;">
                                    <canvas id="Gold-chart"></canvas>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-gold">Zoom In</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-gold">Zoom Out</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-gold">Reset</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Bitcoin Tab -->
                            <div class="tab-pane fade" id="bitcoin-content" role="tabpanel">
                                <div class="chart-container" style="position: relative; height: 300px;">
                                    <canvas id="Bitcoin-chart"></canvas>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-bitcoin">Zoom In</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-bitcoin">Zoom Out</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-bitcoin">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Charts Row -->
                <div class="row mb-4">
                    <!-- CPI Chart -->
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0">Inflation (CPI)</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="position: relative; height: 250px;">
                                    <canvas id="cpi-chart"></canvas>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-cpi">Zoom In</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-cpi">Zoom Out</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-cpi">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comparative Returns Chart -->
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">Comparative Returns</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="position: relative; height: 250px;">
                                    <canvas id="comparative-returns-chart"></canvas>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-in-comparative">Zoom In</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="zoom-out-comparative">Zoom Out</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="reset-zoom-comparative">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Other Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script>

    <!-- Supabase Script - Load this first -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

    <!-- Service Scripts - Load after Supabase is available -->
    <script>
        // Wait for Supabase to be available
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof window.supabase === 'undefined') {
                console.error('Supabase client not available');
            } else {
                console.log('Supabase client available, loading service scripts');

                // Load service scripts in sequence
                const scripts = [
                    'js/services/supabase-config.js',
                    'js/services/base-service.js',
                    'js/services/auth-service.js',
                    'js/services/game-service.js',
                    'js/services/leaderboard-service.js',
                    'js/services/section-service.js',
                    'js/service-bridge.js'
                ];

                // Function to load scripts sequentially
                function loadScripts(index) {
                    if (index >= scripts.length) return;

                    const script = document.createElement('script');
                    script.type = 'module';
                    script.src = scripts[index];
                    script.onload = function() {
                        loadScripts(index + 1);
                    };
                    script.onerror = function() {
                        console.error('Error loading script:', scripts[index]);
                        loadScripts(index + 1);
                    };
                    document.body.appendChild(script);
                }

                // Start loading scripts
                loadScripts(0);
            }
        });
    </script>

    <!-- Header Authentication Script -->
    <script src="js/header-auth.js"></script>

    <!-- Game Scripts - Load these after service scripts are loaded -->
    <script>
        // Wait for service scripts to be loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Check if Service is available every 100ms
            const checkInterval = setInterval(function() {
                if (typeof window.Service !== 'undefined') {
                    clearInterval(checkInterval);
                    console.log('Service is available, loading game scripts');

                    // Load game scripts
                    const gameScripts = [
                        'js/game-core.js',
                        'js/game-ui.js',
                        'js/game-trading.js'
                    ];

                    gameScripts.forEach(function(src) {
                        const script = document.createElement('script');
                        script.src = src;
                        document.body.appendChild(script);
                    });
                }
            }, 100);

            // Set a timeout to prevent infinite checking
            setTimeout(function() {
                clearInterval(checkInterval);
                if (typeof window.Service === 'undefined') {
                    console.error('Service not available after timeout, loading game scripts anyway');

                    // Load game scripts anyway
                    const gameScripts = [
                        'js/game-core.js',
                        'js/game-ui.js',
                        'js/game-trading.js'
                    ];

                    gameScripts.forEach(function(src) {
                        const script = document.createElement('script');
                        script.src = src;
                        document.body.appendChild(script);
                    });
                }
            }, 5000); // 5 second timeout
        });
    </script>

    <!-- Sticky Next Round Button -->
    <div class="sticky-button-container">
        <button id="sticky-next-round" class="sticky-button">Next Round <i class="fas fa-arrow-right"></i></button>
    </div>

    <style>
        .sticky-button-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .sticky-button {
            display: none;
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sticky-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
    </style>

    <script>
        // Ensure the sticky button is properly initialized
        document.addEventListener('DOMContentLoaded', function() {
            const stickyBtn = document.getElementById('sticky-next-round');
            if (stickyBtn) {
                // Initially hide the button
                stickyBtn.style.display = 'none';

                // Show the button when the game starts
                const startBtn = document.getElementById('start-game');
                if (startBtn) {
                    startBtn.addEventListener('click', function() {
                        stickyBtn.style.display = 'flex';
                    });
                }

                // Add event listener for the sticky button
                stickyBtn.addEventListener('click', function() {
                    if (typeof nextRound === 'function') {
                        nextRound();
                    }
                });
            }
        });
    </script>
</body>
</html>
